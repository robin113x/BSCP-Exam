# HTTP Request Smuggling

## 1. HTTP Request Smuggling
- A web attack where an attacker exploits differences in how front-end and back-end servers interpret HTTP requests, allowing them to “smuggle” hidden requests past security controls.

## 2. What happens in an HTTP Request Smuggling attack
- ***The attacker sends a specially crafted request that the front-end and back-end servers parse differently. This causes the back-end to process a hidden request, often leading to unauthorized actions or data theft.***
- The attacker sends one confusing request.
- Front-end server thinks:
	- “Okay, this request ends here.”
- Back-end server thinks:
	- “Wait, there’s more data after this request!”
- The extra hidden request slips through without security checks.
- The attacker can:
	- Steal someone’s session/cookies.
	- Bypass logins/firewalls.
	- Even take over the application.

## 3. How do HTTP request smuggling vulnerabilities arise?
- These vulnerabilities occur when servers in a chain (like proxies, load balancers, and back-end servers) disagree on where an HTTP request ends, usually due to conflicting **Content-Length** and **Transfer-Encoding headers**.
- HTTP/1 has two ways to say how long a request is:
	- Content-Length (tells exact size).
	- Transfer-Encoding: chunked (sends data in pieces).
- If both are used together, servers might disagree:
	- Front-end trusts one.
	- Back-end trusts the other.
- This miscommunication opens the door for attackers.

## 4. How to perform an HTTP Request Smuggling attack
- Attacker crafts a request with both headers (Content-Length + Transfer-Encoding).
- Sends it to the website.
- Front-end forwards part of it to the back-end.
- Back-end reads extra hidden data as a new request.
- Attacker’s “smuggled” request runs in the victim’s session or bypasses checks.
```bash
POST / HTTP/1.1
Host: site.com
Content-Length: 13
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: site.com

```
-Here:
	-Front-end stops reading at 0.
	-Back-end treats GET /admin as a new request.

	

# Methodology
1. Pick an endpoint
2. Prepare Repeater for Request Smuggling
3. Detect the CL.TE Vulnerability
4. Confirm the CL.TE Vulnerability


## Steps for Prepare Repeater for Request Smuggling
1. Downgrade HTTp protocaol to HTTP/1.1
2. Change the request method to POST
3. Disable automatic update of Content-Length
4. Show non-printable characters (\r\n)


## Step for Detect
- HTTP reuest
```http
Content-Length: 6
Transfer-Encoding: chunked
\r\n
3\r\n
abc\r\n
X\r\n
```
- IF Response :  
	- response(backend) -> CL.CL
	- reject(frontend) 
		- -> TE.CL
		- -> TE.TE
	- timeout -> CL.TE  


```http
Content-Length: 6
Transfer-Encoding: chunked
\r\n
3\r\n
abc\r\n
X\r\n
```