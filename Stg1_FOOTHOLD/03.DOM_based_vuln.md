## DOM-based vulnerabilities

### Lab: DOM XSS using web messages


The code:

```
window.addEventListener('message', function(e) {
                            document.getElementById('ads').innerHTML = e.data;
                        })

```

### What’s happening:

- The page listens for messages sent to it via postMessage or other frames/windows.

- Whatever e.data contains is directly inserted into the DOM via innerHTML without sanitization.

- If an attacker can send a crafted message to the page, they can inject arbitrary HTML/JS.

### Why it’s vulnerable
```
- innerHTML interprets input as HTML, so <script> or event handlers (like onerror) will execute.

- The developer has not validated origin (i.e., e.origin) or sanitized e.data.
```

### Attack Steps
-Identify the vulnerable listener:

  - Look for window.addEventListener('message', ...) in JS.

  - Check if the callback uses innerHTML or document.write with untrusted data.

- Verify there’s no origin check:
   ```
   if (e.origin !== "https://trusted-site.com") return;
   If missing → vulnerable.
   
   ```
